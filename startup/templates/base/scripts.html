{% load static %}

<script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
    integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
{% block scripts %}
<script>
    $(document).ready(function (url) {

        function getParamaterByName(url) {
            if (!url) {
                url = window.location.href;
                var pathArray = url.split('/');
            }
            var new_url = '{% url "posts-api:list" %}';
            if (pathArray[3]) {
                new_url += pathArray[3];
            }
            return decodeURIComponent(new_url);
        }

        function getData() {
            var mainContainer = $('#post-section');
            $.ajax({
                method: 'GET',
                url: getParamaterByName(),
                success: function (data) {
                    for (let index = 0; index < data.results.length; index++) {
                        const element = data.results[index];
                        var container = '';
                        if (element.destination) {
                            if (element.post_images.length >= 1) {
                                container = '<div class="card shadow m-4"> \
                                                <div class="pl-3 pt-3 pr-3"> \
                                                    <div class="card"> \
                                                        <div class="card-body p-0 m-0"> \
                                                            <img class="card-img-top" src="'+ element.post_images["0"].image + '" alt=""> \
                                                        </div> \
                                                    </div> \
                                                </div> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a></br> \
                                                    <small>at <a href="#" class="styled-font">#'+ element.destination.name + '</a></small></br> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }
                            else {
                                container = '<div class="card shadow  m-4"> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a></br> \
                                                    <small>at <a href="#" class="styled-font">#'+ element.destination.name + '</a></small></br> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }
                        }
                        else {
                            if (element.post_images.length >= 1) {
                                container = '<div class="card shadow m-4"> \
                                                <div class="pl-3 pt-3 pr-3"> \
                                                    <div class="card"> \
                                                        <div class="card-body p-0 m-0"> \
                                                            <img class="card-img-top" src="'+ element.post_images["0"].image + '" alt=""> \
                                                        </div> \
                                                    </div> \
                                                </div> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a></br> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }
                            else {
                                container = '<div class="card shadow  m-4"> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a></br> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }
                        }
                        mainContainer.append(container);
                    }
                },
                error: function () {
                    console.log('error !!');
                }
            })
        }
        getData();
    });
</script>
{% endblock scripts %}