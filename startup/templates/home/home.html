{% extends 'base/base.html' %}
{% load static %}
{% block content %}
<div class="container">
<h1>Home</h1>
<div class="card-columns" id="post-section">
   
</div>
</div>
{% endblock %}

{% block scripts %}
    <script>
        $(document).ready(function() {
            var url = '/api/posts/';
            var mainContainer = $('#post-section');
            function getData(url){
                $.ajax({
                    method:'GET',
                    url:url,
                    success:function(data){
                        for (let index = 0; index < data.length; index++) {
                            const element = data[index];
                            var container = '';
                            if (element.post_images.length >= 1){
                                container = '<div class="card "> \
                                                <div class="pl-3 pt-3 pr-3"> \
                                                    <div class="card"> \
                                                        <div class="card-body p-0 m-0"> \
                                                            <img class="card-img-top" src="'+ element.post_images["0"].image+'" alt=""> \
                                                        </div> \
                                                    </div> \
                                                </div> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }
                            else {
                                container = '<div class="card "> \
                                                <div class="card-body"> \
                                                    <h4 class="card-title">'+ element.message + '</h4> \
                                                    <p class="card-text">by <a href="#">@'+ element.user.username + '</a> \
                                                    <small>'+ element.timesince + '</small></p> \
                                                </div> \
                                            </div>';
                            }

                            mainContainer.append(container);
                        }
                    },
                    error:function(){
                        console.log('error !!');
                    }
                })
            }
            getData(url);
        });
    </script>
{% endblock %}
